---
title: "feat: Add documentation workflow command"
type: feat
date: 2026-02-13
---

# feat: Add documentation workflow command

## Overview

Add a `/workflows:document` command that updates project documentation after a feature is implemented and reviewed. This fills the gap between `/workflows:review` and `/workflows:compound` in the workflow chain:

```
Research → Brainstorm → Plan → Work → Review → Document → Compound
```

**Brainstorm:** [docs/brainstorms/2026-02-13-documentation-workflow-brainstorm.md](../brainstorms/2026-02-13-documentation-workflow-brainstorm.md)

## Problem Statement

The workflow chain has no step for updating user-facing documentation. Features ship without corresponding doc updates because it's left as a manual afterthought. A structured, propose-then-confirm workflow would make documentation a natural part of the development cycle.

## Proposed Solution

A single workflow command file at `plugins/compound-engineering/commands/workflows/document.md` that follows the established phase-based pattern. Three phases: Discovery → Proposal → Execution.

## Implementation

### File to create

#### `plugins/compound-engineering/commands/workflows/document.md`

The workflow command. Structure:

```yaml
---
name: workflows:document
description: Update project documentation after implementation and review
argument-hint: "[optional: path to brainstorm or plan doc, or PR number]"
---
```

**Phase 1: Discovery**

Gather context about what was built and what docs exist:

1. **Determine diff base** — Check for PR (via `gh pr view`), fall back to `main`/`master`
2. **Git diff analysis** — Run `git diff <base>...HEAD --stat` then read changed files to understand what was built. Filter out test files, generated code, and lock files to keep scope manageable
3. **Chain doc lookup** — Search `docs/brainstorms/` and `docs/plans/` for recent documents matching the current feature (by date, branch name, or topic). If `$ARGUMENTS` provides a path, use that directly. If nothing found, proceed with diff-only mode
4. **Doc inventory** — Use Glob to find existing documentation files: `README*`, `CHANGELOG*`, `docs/**/*.md`, `API.md`, `GUIDE.md`, any `**/README.md` in subdirectories. Note their last-modified dates and sizes
5. **Gap analysis** — Compare what was built (from diff + chain docs) against what's documented. Identify: new features not mentioned in README, missing CHANGELOG entry, outdated API docs, new public APIs without docstrings

**Phase 2: Proposal**

Present a structured update plan to the user:

- For each doc file that needs changes, show: file path, what kind of update (new section, updated section, new entry), and a 1-line summary of the change
- Flag any new docs that should be created (e.g., "No CHANGELOG exists — create one?")
- Flag docs that might need deletion or archival (if features were removed)
- Use `AskUserQuestion` with options:
  1. **Approve all** — Execute all proposed updates
  2. **Select items** — Choose which updates to apply (use multiSelect)
  3. **Skip documentation** — Exit without changes
  4. **Refine proposal** — Ask for adjustments

**Guardrails to prevent overwriting user content:**
- Only modify sections relevant to the changed code — never rewrite entire files
- When updating an existing section, show the diff preview before applying
- Detect and preserve custom sections (anything not generated by this workflow)
- For README: append new feature sections, don't restructure existing content

**Phase 3: Execution**

Make the approved changes:

1. For each approved update, read the target file, make the change, write it back
2. Match existing doc style (detect heading levels, tone, formatting from surrounding content)
3. For CHANGELOG: use Keep a Changelog format if one exists, otherwise detect existing format
4. After all updates, show a summary: files changed, sections added/updated
5. Offer handoff via `AskUserQuestion`:
   1. **Continue to `/workflows:compound`** — Document solved problems for team knowledge
   2. **Review changes** — Load `document-review` skill for quality pass
   3. **Done** — Documentation complete

### Edge cases to handle

- **No existing docs:** Offer to scaffold a minimal doc structure (README + CHANGELOG) rather than silently failing
- **No git diff:** If on main with no changes, check `$ARGUMENTS` for a PR number. If nothing, tell the user and exit
- **Doc-only changes in diff:** Detect and exit early — "Changes are documentation-only, nothing additional to document"
- **Massive diffs (50+ files):** Summarize by directory/component rather than file-by-file. Focus on public API changes
- **No chain docs found:** Proceed with diff-only mode, mention that brainstorm/plan context would improve results

### Files to update (plugin metadata)

After creating the command, update these files per the plugin's versioning requirements:

- [ ] `plugins/compound-engineering/.claude-plugin/plugin.json` — bump minor version, update command count in description
- [ ] `.claude-plugin/marketplace.json` — update description with new command count
- [ ] `plugins/compound-engineering/README.md` — add `/workflows:document` to commands list
- [ ] `plugins/compound-engineering/CHANGELOG.md` — add entry under new version

### Optional: Update review workflow handoff

Update `plugins/compound-engineering/commands/workflows/review.md` to offer `/workflows:document` as a next step after review completes. Add an option in the final handoff section.

## Acceptance Criteria

- [ ] `/workflows:document` command exists and loads correctly
- [ ] Phase 1 discovers changed files via git diff and finds chain docs when available
- [ ] Phase 2 presents a clear proposal listing each doc update needed
- [ ] User can approve all, select specific items, or skip
- [ ] Phase 3 makes only approved changes without overwriting unrelated content
- [ ] Handoff to `/workflows:compound` works
- [ ] Plugin metadata (version, counts, changelog) updated correctly
- [ ] Works in diff-only mode when no chain docs exist

## References

- Workflow pattern: `plugins/compound-engineering/commands/workflows/work.md`
- Handoff pattern: `plugins/compound-engineering/commands/workflows/compound.md`
- Doc style skills: `plugins/compound-engineering/skills/document-review/`, `plugins/compound-engineering/skills/every-style-editor/`
- Plugin versioning: `docs/solutions/plugin-versioning-requirements.md`
