---
name: compound:configure
description: Interactive setup to customize which plugin components load into your context
---

# Configure Compound Engineering Plugin

This command creates a customized version of compound-engineering that only loads the components you need, reducing context window usage by 30-50%.

## Prerequisites

This command requires:
1. The compound-engineering plugin is installed from a marketplace
2. The installed plugin has the `_source/` directory and `bin/build` script

## Step 1: Find the Installed Plugin

First, find where compound-engineering is installed by reading `~/.claude/plugins/installed_plugins.json`.

Look for an entry like `"compound-engineering@every-marketplace"` or similar and get the `installPath`.

Example:
```json
"compound-engineering@every-marketplace": [
  {
    "installPath": "/Users/username/.claude/plugins/cache/every-marketplace/compound-engineering/2.27.0",
    ...
  }
]
```

**CRITICAL:** Verify the plugin has the build infrastructure:
```bash
ls -la <installPath>/bin/build
ls -la <installPath>/_source/
```

If `bin/build` or `_source/` don't exist, tell the user:
> "Your installed version doesn't support custom configuration. Please update the plugin or install from a marketplace that includes the configuration feature."

Then stop.

## Step 2: Gather User Preferences

Use the **AskUserQuestion** tool to ask these questions ONE AT A TIME:

### Question 1: Primary Language
**Question:** "What is your primary programming language?"
**Options:**
- Ruby/Rails (Recommended for Rails developers)
- Python
- TypeScript/JavaScript
- Multiple languages (keep all reviewers)

### Question 2: Design Tools
**Question:** "Do you use Figma for design work?"
**Options:**
- Yes, I use Figma
- No, I don't use Figma

### Question 3: Browser Automation
**Question:** "Do you need browser automation capabilities?"
**Options:**
- Yes, for testing or automation
- No, I don't need browser automation

### Question 4: Image Generation
**Question:** "Do you need AI image generation (requires Gemini API key)?"
**Options:**
- Yes, I have a Gemini API key
- No, I don't need image generation

### Question 5: Content Editing
**Question:** "Do you write content that needs Every.to style guide compliance?"
**Options:**
- Yes, I write for Every.to
- No, I don't need Every style editing

## Step 3: Build the Configuration

Based on answers, build the config JSON:

```json
{
  "$schema": "./compound.config.schema.json",
  "description": "Custom configuration generated by /compound:configure",
  "agents": {
    "enabled": ["*"],
    "disabled": []
  },
  "commands": {
    "enabled": ["*"],
    "disabled": ["xcode-test", "feature-video", "report-bug"]
  },
  "skills": {
    "enabled": ["*"],
    "disabled": []
  },
  "mcpServers": {
    "enabled": ["*"],
    "disabled": []
  }
}
```

**Add to disabled based on answers:**

| Answer | Add to agents.disabled | Add to skills.disabled |
|--------|----------------------|----------------------|
| Ruby/Rails | `kieran-python-reviewer`, `kieran-typescript-reviewer` | |
| Python | `kieran-rails-reviewer`, `dhh-rails-reviewer`, `kieran-typescript-reviewer` | `dhh-rails-style`, `andrew-kane-gem-writer` |
| TypeScript | `kieran-rails-reviewer`, `dhh-rails-reviewer`, `kieran-python-reviewer` | `dhh-rails-style`, `andrew-kane-gem-writer` |
| No Figma | `figma-design-sync`, `design-implementation-reviewer`, `design-iterator` | |
| No browser | | `agent-browser` |
| No image gen | | `gemini-imagegen` |
| No Every style | `every-style-editor` | `every-style-editor` |

Also add `test-browser` to commands.disabled if no browser automation.

## Step 4: Create Custom Plugin

Run these commands in sequence:

```bash
# 1. Create the local plugins directory structure
mkdir -p ~/.claude/plugins/local/compound-engineering-custom/.claude-plugin

# 2. Copy entire plugin from installed location (PLUGIN_PATH is from Step 1)
cp -r <PLUGIN_PATH>/* ~/.claude/plugins/local/compound-engineering-custom/

# 3. Verify the copy worked
ls ~/.claude/plugins/local/compound-engineering-custom/bin/build
```

## Step 5: Write Custom Config

Use the Write tool to create the config file:

**File:** `~/.claude/plugins/local/compound-engineering-custom/compound.config.json`

Write the JSON config built in Step 3.

## Step 6: Run the Build

```bash
cd ~/.claude/plugins/local/compound-engineering-custom && ./bin/build
```

This will output something like:
```
Building compound-engineering plugin...
Agents: Available: 27, Enabled: 21
Commands: Available: 24, Enabled: 21
Skills: Available: 14, Enabled: 12
Build complete! 54/65 components enabled.
```

## Step 7: Update Plugin Metadata

Read and update the plugin.json to mark this as a custom version:

**File:** `~/.claude/plugins/local/compound-engineering-custom/.claude-plugin/plugin.json`

Change:
- `"name"` → `"compound-engineering-custom"`
- `"version"` → append `-custom` (e.g., `"2.27.0-custom"`)
- `"description"` → update to reflect customization

## Step 8: Setup Local Marketplace

Create the local marketplace structure:

```bash
mkdir -p ~/.claude/plugins/local/.claude-plugin
```

Write marketplace.json:

**File:** `~/.claude/plugins/local/.claude-plugin/marketplace.json`

```json
{
  "name": "local",
  "owner": { "name": "Local Plugins" },
  "metadata": { "description": "Local custom plugins", "version": "1.0.0" },
  "plugins": [
    {
      "name": "compound-engineering-custom",
      "description": "Custom build of compound-engineering",
      "version": "2.27.0-custom",
      "source": "./compound-engineering-custom"
    }
  ]
}
```

## Step 9: Register Local Marketplace

Read `~/.claude/plugins/known_marketplaces.json` and add:

```json
"local": {
  "source": {
    "source": "directory",
    "path": "/Users/<username>/.claude/plugins/local"
  },
  "installLocation": "/Users/<username>/.claude/plugins/local",
  "lastUpdated": "<current ISO timestamp>"
}
```

Use the actual home directory path, not `~`.

## Step 10: Register Installed Plugin

Read `~/.claude/plugins/installed_plugins.json` and add:

```json
"compound-engineering-custom@local": [
  {
    "scope": "user",
    "installPath": "/Users/<username>/.claude/plugins/local/compound-engineering-custom",
    "version": "2.27.0-custom",
    "installedAt": "<current ISO timestamp>",
    "lastUpdated": "<current ISO timestamp>"
  }
]
```

## Step 11: Update Settings

Read `~/.claude/settings.json` and in the `enabledPlugins` object:

1. Set the original marketplace plugin to `false`:
   - `"compound-engineering@every-marketplace": false`
2. Add and enable the custom plugin:
   - `"compound-engineering-custom@local": true`

## Step 12: Summary

Tell the user:

```
Configuration complete!

Your custom compound-engineering plugin:
- Agents: X enabled (Y disabled)
- Commands: X enabled (Y disabled)
- Skills: X enabled (Y disabled)
- Estimated context savings: ~Z tokens

Files created:
- ~/.claude/plugins/local/compound-engineering-custom/

Settings updated:
- compound-engineering@every-marketplace: disabled
- compound-engineering-custom@local: enabled

**Restart Claude Code to apply changes.**

To reconfigure later:
1. Edit ~/.claude/plugins/local/compound-engineering-custom/compound.config.json
2. Run: cd ~/.claude/plugins/local/compound-engineering-custom && ./bin/build
3. Restart Claude Code

To restore full plugin:
1. Set "compound-engineering@every-marketplace": true in ~/.claude/settings.json
2. Set "compound-engineering-custom@local": false
3. Restart Claude Code
```

## Error Handling

If any step fails:
- **No bin/build:** Plugin version doesn't support configuration
- **Build fails:** Check Ruby is installed (`ruby --version`)
- **JSON parse error:** Validate JSON before writing
- **Permission denied:** Check file permissions

Always validate JSON files with `jq` after writing:
```bash
cat <file> | jq . > /dev/null && echo "Valid" || echo "Invalid JSON"
```
